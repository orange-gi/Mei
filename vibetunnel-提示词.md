# VibeTunnel 提示词分析文档

## 文档概述

本文档对 VibeTunnel 项目中使用的提示词（Prompt）进行系统性分析。VibeTunnel 是一个专注于为 AI 辅助编程工具提供标准化开发上下文的开源项目，通过精心设计的提示词系统，确保不同 AI 代理在参与项目开发时能够获得一致的背景信息和约束条件。本分析涵盖了项目中所有主要的提示词文件，包括 CLAUDE.md、AGENT.md 和 GEMINI.md，从提示词的位置、内容，设计模式、变量处理到优化建议进行全面剖析。通过这些分析，开发者可以深入理解 VibeTunnel 的 AI 协作策略，并为类似项目的提示词工程提供参考范式。

## 提示词位置与文件结构

### CLAUDE.md 文件位置与内容

CLAUDE.md 文件位于项目根目录，是 VibeTunnel 项目中最核心的 AI 代理指导文件。该文件通过 GitHub 的集成机制，在用户使用 Claude Code（claude.ai/code）时自动加载，为 AI 代理提供项目开发所需的全部上下文信息。文件采用 Markdown 格式编写，总大小约为 15,881 字节，包含丰富的结构化内容，从项目概述到具体的技术细节都有详尽说明。这种集中式的提示词管理方式，使得项目维护者可以统一管理所有 AI 代理的行为规范，大大降低了因提示词分散而导致的不一致风险。

CLAUDE.md 的文件路径为项目根目录，直接位于 VibeTunnel 项目的顶层。GitHub 平台会自动识别该文件并在 Claude Code 会话开始时注入其内容。这种设计利用了 Claude Code 的内置功能，开发者无需进行额外配置即可实现 AI 代理的上下文注入。文件内容的组织遵循从宏观到微观的逻辑顺序，首先介绍项目整体架构，然后逐步深入到具体的开发命令、代码质量要求、架构细节，最后以关键文件和重要提醒收尾。这种层次分明的结构确保了 AI 代理能够快速定位所需信息，避免在大量文本中迷失方向。

### AGENT.md 文件位置与内容

AGENT.md 文件同样位于项目根目录，与 CLAUDE.md 并列存在，形成双层提示词体系。该文件相较于 CLAUDE.md 更为精简（约 1,656 字节），专注于提供最核心的开发命令和架构概要。文件内容采用极简主义风格，避免冗余描述，直接列出构建、测试、代码风格等关键指令。AGENT.md 的设计理念是提供「快速参考卡」，让 AI 代理能够在一分钟内掌握项目开发的核心要点，而无需阅读长篇文档。

从文件命名可以推断，AGENT.md 旨在为通用的 AI 代理提供指导，而非特定于某一平台。这种设计使得项目可以同时支持多种 AI 代理工具，不同的 AI 系统可以根据自己的能力选择加载不同的提示词文件。VibeTunnel 项目采用 CLAUDE.md 和 AGENT.md 并存的方式，既保证了 Claude Code 用户获得详尽指导，又为其他 AI 代理保留了基本的工作规范。这种兼容性设计体现了项目团队对 AI 生态多样性的深刻理解和尊重。

### GEMINI.md 文件位置与内容

GEMINI.md 文件位于项目根目录，专门为 Google Gemini CLI 工具设计指导。该文件是三个提示词文件中最小的一个（约 660 字节），内容简洁明了，主要强调两点核心要求：在执行任何任务之前必须阅读 claude.md 文件，以及如果当前工作目录是子文件夹，则必须读取当前文件夹及其所有父目录中的所有 claude.md 文件。这种层级化的上下文读取机制，确保了 Gemini 在处理项目不同部分时都能获得正确的开发上下文。

GEMINI.md 的存在表明 VibeTunnel 项目团队积极支持多种 AI 辅助编程工具，而非局限于单一平台。通过为不同 AI 工具提供定制化的提示词，项目实现了跨平台的 AI 代理一致性指导。这种策略对于大型开源项目尤为重要，因为不同的开发者和贡献者可能使用不同的 AI 工具，而统一的提示词标准可以确保所有参与者都遵循相同的开发规范和质量标准。文件使用 read_many_files 工具进行高效信息收集的设计，也展示了项目对 AI 代理工作流程的深入理解。

## 完整提示词内容分析

### CLAUDE.md 完整内容解析

CLAUDE.md 文件采用了系统化的结构组织方式，将内容划分为多个功能区域。首先是项目概述部分，明确指出 VibeTunnel 是一个允许用户通过任何 Web 浏览器访问终端会话的 macOS 应用程序，并简要说明了三大主要组件：macOS 菜单栏应用、iOS 配套应用以及 Web 前端和 Node.js/Bun 服务器。这一概述为 AI 代理建立了对项目的基本认知框架，使其能够理解后续详细内容在整个项目中的定位和作用。

接下来是常见开发命令部分，这是文件中篇幅最长的章节之一。构建命令被细分为 macOS 应用、iOS 应用和 Web 前端三大类，每类都提供了多种构建方式的详细指令，包括使用 Poltergeist 自动构建的推荐方式和直接使用 xcodebuild 的备用方式。测试命令同样按照平台分类，详细列出了运行测试和代码覆盖率检查的具体指令。代码质量命令提供了格式检查、代码检查和自动修复的具体方法。这些命令的详尽列出，确保了 AI 代理在进行代码修改后能够正确运行相应的验证步骤。

高级架构部分提供了系统的宏观视图，通过 ASCII 艺术风格的组件概览图，直观展示了 macOS 菜单栏应用、Node.js/Bun 服务器和 Web 前端三大组件之间的关系。关键通信流的描述解释了会话创建、终端 I/O、缓冲协议和日志聚合的工作原理。关键文件位置部分列出了入口点、配置和终端管理的核心文件路径，方便 AI 代理在需要时快速定位相关代码。架构信息的详细程度表明项目团队认识到，为 AI 代理提供准确的代码位置信息可以显著提高其代码理解和修改的准确性。

### AGENT.md 完整内容解析

AGENT.md 文件采用了高度结构化的表格形式来组织信息，这种设计使得内容易于扫描和快速理解。文件开篇直接列出构建和测试命令的参考表格，包含了 Web 和 macOS 两大平台的主要开发命令。表格采用简洁的代码块格式，每行命令都附带简短说明，让 AI 代理能够一目了然地理解每条命令的用途和执行方式。这种设计避免了冗长的文字描述，在保持信息完整性的同时最大化了信息密度。

架构部分采用了简洁的描述性文字，而非图形化展示。文件简要说明了项目的三层架构：原生 macOS 应用（Swift/SwiftUI）位于本地层、iOS 配套应用提供移动端支持、Web 技术栈则包含 TypeScript/LitElement 前端和 Node.js/Bun 服务器。API 说明部分列出了核心 API 端点的基本路径，包括会话管理的 /api/sessions 和 WebSocket 的 /ws 路径。入口点部分则按组件分类列出了关键文件，如 macOS 应用入口、服务器入口、Web UI 入口和 iOS 应用入口。

代码风格部分提供了项目遵循的编码规范，包括 TypeScript 和 Swift 的命名约定、导入排序规则、错误处理方式和向后兼容性政策。特别值得注意的是，文件明确指出「没有向后兼容性」这一关键规则，强调 Mac 应用和 Web 服务器总是作为一个整体发布，不存在不同版本之间通信的场景。这条规则对于 AI 代理理解项目架构决策至关重要，可以避免在代码修改时引入不必要兼容性层。文件长度建议也体现了务实精神，允许代码文件保持适度长度而无需过度拆分。

### GEMINI.md 完整内容解析

GEMINI.md 文件虽然篇幅最短，但内容精准有效。文件核心是两条明确的行为指令：第一条要求 Gemini 在执行任何任务之前必须阅读 claude.md 文件；第二条定义了上下文感知的层级读取规则，即如果当前工作目录是子文件夹，必须读取当前文件夹及其所有父目录直到项目根目录中的所有 claude.md 文件。这种设计解决了大型项目中 AI 代理可能因只读取单一提示词文件而缺失部分上下文的问题。

文件最后指定使用 read_many_files 工具来高效收集信息，这不仅是一条技术建议，更是对 Gemini 工作机制的优化指导。通过鼓励使用批量文件读取工具，项目确保了 Gemini 能够一次性获取所有相关的提示词信息，避免因逐个读取文件而产生的上下文丢失和时间浪费。这种对工具使用的具体指导，体现了项目团队对 AI 代理工作流程的细致考量，使得 Gemini 能够更高效地理解和执行开发任务。

## 提示词设计模式分析

### 分层上下文设计模式

VibeTunnel 项目采用了精心设计的分层上下文模式来组织提示词内容。这种模式的核心思想是将信息按照重要性和使用频率进行分层，使得 AI 代理能够首先获取最关键的信息，然后在需要时深入到细节层面。在 CLAUDE.md 中，这一模式表现为：从项目概述到具体命令，从高级架构到低级文件路径，内容逐渐从抽象走向具体。这种递进式的组织方式符合认知规律，让 AI 代理能够「先见森林，再见树木」。

分层设计在多文件体系中得到了进一步强化。GEMINI.md 中定义的层级读取规则，就是这种分层思想的典型体现。项目根目录的 CLAUDE.md 提供全局项目级指导，子目录中的 CLAUDE.md（如果存在）则提供更具体的目录级指导。这种设计使得项目能够处理复杂的代码库结构，不同模块可以拥有自己的开发规范，而同时保持与整体项目规范的一致性。对于 AI 代理而言，这意味着它能够获得与其当前工作区域最相关的上下文信息，避免全局规范与局部需求之间的冲突。

分层设计还体现在不同提示词文件的功能分工上。CLAUDE.md 提供详尽的全面指导，AGENT.md 提供快速参考，GEMINI.md 则专注于解决 Gemini 特有的上下文读取问题。这种分工合作的方式，避免了单个提示词文件的过度臃肿，同时确保了每种使用场景都有对应的最佳解决方案。项目团队显然认识到，不同的 AI 工具有不同的工作特点和限制，因此需要针对性地提供适配方案，而非一刀切式的统一提示词。

### 规则优先的设计原则

VibeTunnel 的提示词系统采用了明确的「规则优先」设计原则，将最重要的行为约束放在最显眼的位置。在 CLAUDE.md 中，「绝对核心规则」（ABSOLUTE CARDINAL RULES）部分被用粗体标题和警告图标突出显示，其中包含的八条规则每一条都以大写字母开头，强调其不可违背的性质。这种视觉上的强调，确保了 AI 代理在处理任何任务之前都能够首先注意到这些关键约束。

规则的内容涵盖了项目开发的各个方面，从禁止创建分支（除非获得明确授权）到禁止提交和推送（直到用户测试通过），从禁止使用 git rebase --skip 到禁止创建重复文件。文件还特别警告了测试会话管理的重要性，明确指出 AI 代理可能正在 VibeTunnel 会话中运行，杀伤所有会话会导致自身进程终止。这些具体而明确的规则，反映了项目团队在实际开发中遇到的问题和教训，通过将它们编码到提示词中，可以有效避免 AI 代理重蹈覆辙。

「零向后兼容性」这一规则的表述方式尤其值得注意。文件不仅说明了规则的内容，还解释了背后的原因：「Mac 应用和 Web 服务器总是作为一个整体发布，不存在不同版本之间通信的场景。」这种「规则加解释」的方式，帮助 AI 代理理解规则存在的合理性，而非盲目遵守死板的指令。对于代码风格、错误处理等规范，文件同样提供了清晰的设计理念说明，使得 AI 代理在进行代码修改时能够做出符合项目整体设计意图的决策。

### 工具与命令的系统化呈现

VibeTunnel 的提示词系统采用了系统化的方式呈现工具和命令，确保 AI 代理能够准确理解和正确使用各种开发工具。在 CLAUDE.md 中，每个命令类别都有清晰的标题标识，命令本身使用代码块格式，参数说明紧随其后。值得注意的是，文件不仅提供了命令的预期输出，还说明了常见错误和警告信息，例如在使用 xcodebuild 测试时的平台指定要求。这种全面的命令文档，使得 AI 代理几乎不需要额外查询即可执行任何开发任务。

命令的组织遵循了逻辑分组原则。构建命令按照 macOS 应用、iOS 应用、Web 前端三个主要组件分类；测试命令按照平台和测试类型分类；调试和日志命令则按照使用场景分类。每组命令的开头都有简短的情境说明，帮助 AI 代理理解该命令在何种情况下会被使用。文件还特别标注了一些重要的注意事项，如「绝对不要在 Claude Code 中使用 -f（跟随模式）」，这些细节体现了对 AI 代理实际工作流程的深入观察和优化。

对于多步骤的复杂流程，提示词采用了过程式的描述方式。以 Poltergeist 集成部分为例，文件不仅说明了如何检查 Poltergeist 是否已安装，还按步骤列出了启动、监控和使用的完整流程，包括每个步骤的具体命令和预期输出。这种详尽的过程指导，确保了 AI 代理能够正确完成复杂的开发任务，而非仅仅知道存在某个工具可用。对于错误处理和回退方案，文件同样提供了明确指导，如当 Poltergeist 不可用时的备用构建方式。

## 变量与模板处理方式

### 路径变量的使用模式

VibeTunnel 提示词中大量使用了路径变量来引用文件和目录，这是提供准确上下文的有效方式。在 CLAUDE.md 中，关键文件路径按照类型分组列出，例如入口点配置、配置相关文件和终端管理相关文件。每条路径都使用代码格式化，确保 AI 代理能够准确识别路径边界，避免因路径解析错误导致的操作失误。路径的组织方式遵循了从核心到外围的逻辑，主要入口文件和配置位于列表前部，辅助性文件和目录则放在后面。

路径变量在命令示例中的使用尤为关键。例如，在说明如何查看日志时，提示词直接给出了具体的命令示例：`./scripts/vtlog.sh -n 100` 和 `cd web && pnpm run dev --port 4021 --bind 0.0.0.0`。这些命令中的相对路径都是相对于项目根目录定义的，AI 代理可以根据这一约定正确执行命令。文件还特别指出了一些路径相关的注意事项，如「开发服务器运行在 4020 端口，所以使用 4021 作为开发端口以避免冲突」，这种细节信息的提供帮助 AI 代理避免常见的配置错误。

对于跨平台路径问题，提示词采取了一致的约定。尽管项目主要面向 macOS 环境，但涉及路径的命令示例都采用了 Unix 风格的正斜杠，这既符合 macOS 的默认文件系统，也为将来可能的 Linux 部署保留了兼容性。文件在涉及路径的地方都使用了相对路径而非绝对路径，这一设计选择体现了项目对不同工作环境的适应性考虑，使得 AI 代理无论在何种环境下都能正确执行命令。

### 参数与选项的模板化

VibeTunnel 提示词采用了模板化的方式呈现命令参数和选项，便于 AI 代理理解和构造类似的命令。在描述 xcodebuild 命令时，提示词使用了占位符如 `-project VibeTunnel.xcodeproj` 和 `-scheme VibeTunnel`，这些固定参数与可变参数（如目标平台）明确区分，帮助 AI 代理识别哪些是可变的、哪些是固定的。对于可选参数，提示词通常使用方括号表示，如 `-sdk iphonesimulator`，表明这是可以根据情况调整的部分。

参数的分组和层次结构在提示词中得到了清晰呈现。以 Web 前端测试命令为例，文件将命令组织为 `pnpm run test`、`pnpm run test:coverage` 和 `pnpm run test:e2e` 等多个变体，每个变体都有明确的功能说明。这种分组方式帮助 AI 代理理解参数之间的关系，以及如何通过组合不同选项来满足特定需求。对于复杂的命令组合，提示词还提供了使用场景说明，如「调试 E2E 测试」和「运行覆盖率报告」，使得参数选择更加情境化。

参数的默认值和常见值也在提示词中明确标注。例如，在描述端口绑定时，文件说明了默认端口是 4020，可以通过 `--port <number>` 参数自定义。这种对默认值的说明，帮助 AI 代理理解在未指定参数时系统的预期行为，避免因参数缺失导致的意外结果。对于相互排斥或互为替代的参数选项，提示词通过分组和说明明确了两者的适用场景，如「开发模式（推荐）」和「生产模式」的对比说明。

### 动态内容处理策略

VibeTunnel 提示词采用了多种策略来处理动态内容，即那些需要根据上下文变化的信息。在描述日志级别时，提示词列出了从安静模式到调试模式的完整级别序列，并说明了每个级别对应的参数标志和环境变量。这种完整的枚举，确保了 AI 代理能够根据需要选择正确的日志级别，而非猜测可能存在的选项。文件还说明了日志输出位置的恒定性：「日志级别仅控制终端输出，所有日志始终写入 ~/.vibetunnel/log.txt」，这种信息的明确化帮助 AI 代理正确理解日志系统的行为。

对于需要根据运行时环境变化的信息，提示词采用了条件描述的方式。例如，在说明 WebSocket 升级处理时，文件描述了不同的 URL 解析场景和对应的处理逻辑。对于路径处理，提示词详细说明了开发模式和 npm 包模式下的不同行为，以及如何检测当前所处的环境模式。这种条件化的描述方式，确保了 AI 代理能够根据实际情况做出正确的判断，而非依赖单一路径处理所有情况。

动态版本信息的处理是另一个值得关注的设计点。VibeTunnel 项目有版本号、构建日期等动态信息，这些信息在提示词中通过占位符方式引用（如 `docs/RELEASE.md`），而非硬编码具体值。这种设计确保了提示词内容的长期有效性，即使项目版本更新，提示词依然准确有效。对于需要运行时获取的信息（如端口号、进程 ID），提示词通常会说明如何通过 API 或命令动态获取，而非假设存在固定值。

## 优化建议与最佳实践

### 提示词内容精简策略

尽管 VibeTunnel 的提示词内容详尽，但仍有进一步精简和优化的空间。首先，对于高度重复的命令选项（如 `-v`、`--verbose`、`-vv` 等变体），可以考虑使用表格或列表形式进行汇总呈现，而非在多处重复描述。重复信息不仅增加了提示词的长度，也增加了 AI 代理处理信息的认知负担。通过将类似信息集中展示，可以提高信息的可检索性和可理解性。

其次，某些技术细节可以下沉到专门的参考文档中，而非全部放在主提示词文件中。例如，Tailscale CLI 的具体命令语法可以移至 `docs/tailscale.md` 文件中，主提示词仅保留关键信息和高层次指导。这种层次化的文档结构，既保持了主提示词的简洁性，又为需要深入了解的开发者保留了详细参考。文件引用的设计已经在 CLAUDE.md 中有所体现，但可以更加系统和彻底。

第三，考虑为不同熟练度的 AI 代理提供分级的提示词版本。初级用户可能需要更多的背景信息和手把手指导，而经验丰富的 AI 代理可能只需要关键规则和快速参考。通过提供可选择的提示词子集或模块化设计，可以满足不同场景的需求。对于 CLAUDE.md 这样的综合性文件，可以考虑提取一个「快速入门」子集，让 AI 代理先获得最小必要信息，在需要时再获取详细指导。

### 上下文注入效率优化

从上下文注入效率的角度，可以考虑对提示词进行结构化优化。当前 CLAUDE.md 采用的线性结构虽然易于阅读，但对于 AI 代理而言可能不是最高效的信息组织方式。可以考虑在文件开头添加一个结构化的摘要部分，使用明确的标记（如 JSON 或 YAML 格式）列出关键配置、规则和命令，使得 AI 代理能够快速获取结构化信息，而非逐行解析文本。

对于多文件提示词体系（如项目级和目录级的 CLAUDE.md），可以考虑引入明确的优先级声明和冲突解决规则。当前 GEMINI.md 中描述的层级读取规则解决了文件发现的问题，但并未明确说明当不同层级的提示词发生冲突时应该如何处理。通过添加「项目级规则优先于目录级规则」或「更具体规则优先」等明确声明，可以帮助 AI 代理在遇到不一致时做出正确的判断。

提示词的版本控制和动态更新也是值得考虑的方向。当前提示词文件中的一些信息（如命令语法）可能会随项目更新而变化，如果没有相应的版本控制机制，可能会导致提示词与实际项目状态脱节。可以考虑在提示词中包含最后验证日期或项目版本号范围声明，帮助 AI 代理判断提示词的时效性和可信度。对于频繁变化的命令语法，可以考虑引用自动生成或持续集成的命令文档，而非直接嵌入提示词。

### AI 代理协作模式改进

VibeTunnel 的多提示词设计（CLAUDE.md、AGENT.md、GEMINI.md）体现了对不同 AI 工具的支持，但可以进一步优化这些提示词之间的协作模式。建议引入统一的「提示词元数据」标准，包含提示词版本、目标 AI 工具、适用范围和最后更新时间等信息。这种元数据不仅有助于提示词的管理和维护，也能帮助 AI 代理更好地理解和使用这些指导文件。

对于跨 AI 工具的一致性保障，可以考虑创建一个共享的核心规则集，该规则集被所有提示词文件引用。核心规则集包含项目最重要的约束和约定，如「禁止在未测试的情况下提交代码」这样的核心规则。通过集中定义这些规则，可以确保无论 AI 代理使用哪个提示词文件，都能获得一致的核心指导。差异化内容则可以针对不同 AI 工具的特点进行定制，实现一致性与特异性的平衡。

最后，建议建立提示词的使用反馈机制。AI 代理在执行任务后，可以提供关于提示词有效性的反馈，如哪些指令清晰易懂、哪些存在歧义或遗漏。这些反馈信息可以帮助项目维护者持续优化提示词质量，形成改进闭环。虽然当前 Claude Code 平台可能没有直接支持这种反馈机制，但项目可以通过定期审查和用户报告来收集改进建议，保持提示词与项目实际需求的一致性。

## 总结

VibeTunnel 项目在 AI 代理提示词工程方面展现出了系统化的思考和精细的设计。通过 CLAUDE.md、AGENT.md 和 GEMINI.md 三个层次分明的提示词文件，项目成功地为不同 AI 工具提供了定制化的开发上下文，同时保持了核心规则的一致性。分层上下文设计、规则优先原则和命令系统化呈现等设计模式，为类似开源项目提供了值得借鉴的参考范式。

从提示词内容来看，VibeTunnel 团队投入了大量精力来确保 AI 代理能够准确理解和执行开发任务。详尽的命令文档、清晰的规则说明和周全的错误处理指导，体现了对 AI 代理工作流程的深入理解。特别是「绝对核心规则」部分的具体约束和「零向后兼容性」的政策声明，展示了项目团队在长期实践中积累的宝贵经验。

在优化方向上，提示词的内容精简、结构化摘要、版本控制和反馈机制等改进点值得关注。随着 AI 辅助编程工具的不断演进，提示词工程也将持续发展。VibeTunnel 的实践表明，精心设计的提示词系统能够显著提升 AI 代理在复杂项目中的工作效率和代码质量，是现代软件开发流程中不可或缺的重要组成部分。
